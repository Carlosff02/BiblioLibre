<!-- Main Content -->
<main class="container mx-auto px-6 py-16">
  <div class="flex flex-col lg:flex-row gap-12">

    <!-- Filters Sidebar -->
    <aside class="w-full lg:w-1/4">
      <h3 class="text-2xl font-bold text-gray-900 mb-6">Filtros</h3>
      <div class="bg-white p-6 rounded-lg shadow-md">
        <h4 class="font-semibold text-lg mb-4 border-b pb-3">Idioma</h4>
        <ul class="space-y-3">
  <li><a (click)="seleccionarIdioma('todos')" class="cursor-pointer" [ngClass]="getClaseIdioma('todos')">Todos</a></li>
  <li><a (click)="seleccionarIdioma('english')" class="cursor-pointer" [ngClass]="getClaseIdioma('english')">Ingl√©s</a></li>
  <li><a (click)="seleccionarIdioma('espa√±ol')" class="cursor-pointer" [ngClass]="getClaseIdioma('espa√±ol')">Espa√±ol</a></li>
  <li><a (click)="seleccionarIdioma('french')" class="cursor-pointer" [ngClass]="getClaseIdioma('french')">Franc√©s</a></li>
  <li><a (click)="seleccionarIdioma('deutsch')" class="cursor-pointer" [ngClass]="getClaseIdioma('deutsch')">Alem√°n</a></li>
  <li><a (click)="seleccionarIdioma('italiano')" class="cursor-pointer" [ngClass]="getClaseIdioma('italiano')">Italiano</a></li>
  <li><a (click)="seleccionarIdioma('portugues')" class="cursor-pointer" [ngClass]="getClaseIdioma('portugues')">Portugu√©s</a></li>
  <li><a (click)="seleccionarIdioma('dutch')" class="cursor-pointer" [ngClass]="getClaseIdioma('dutch')">Holand√©s</a></li>
  <li><a (click)="seleccionarIdioma('sueco')" class="cursor-pointer" [ngClass]="getClaseIdioma('sueco')">Sueco</a></li>
  <li><a (click)="seleccionarIdioma('ruso')" class="cursor-pointer" [ngClass]="getClaseIdioma('ruso')">Ruso</a></li>
  <li><a (click)="seleccionarIdioma('japones')" class="cursor-pointer" [ngClass]="getClaseIdioma('japones')">Japon√©s</a></li>
</ul>
      </div>
    </aside>

    <!-- Search Results -->
    <section class="w-full lg:w-3/4">
      <div class="flex flex-col sm:flex-row justify-between items-center mb-6 gap-4">
        <h2 class="text-3xl font-bold text-gray-900">Resultados de B√∫squeda</h2>
        <span class="text-gray-500 text-sm sm:text-base">
          Mostrando {{ libros().length }} de {{ totalElementos }} libros
        </span>
      </div>

      <!-- üîç Formulario de b√∫squeda -->
      <form
        (ngSubmit)="buscarLibros()"
        class="bg-white p-4 rounded-lg shadow-md flex flex-col sm:flex-row gap-4 mb-8"
      >
        <input
          [(ngModel)]="titulo"
          name="titulo"
          placeholder="Buscar por t√≠tulo"
          class="border rounded-lg px-4 py-2 w-full sm:w-1/3 focus:ring-2 focus:ring-indigo-500 outline-none"
        />
        <input
          [(ngModel)]="autor"
          name="autor"
          placeholder="Buscar por autor"
          class="border rounded-lg px-4 py-2 w-full sm:w-1/3 focus:ring-2 focus:ring-indigo-500 outline-none"
        />
        <button
          type="submit"
          class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold px-6 py-2 rounded-lg transition"
          [disabled]="procesandoDatos()"
        >
          Buscar
        </button>
      </form>
      @if(!procesandoDatos() && libros().length > 0){
      <!-- Resultados -->
      <div >
        <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-6">
          @for (libro of libros(); track $index) {
            <a [routerLink]="['visor', libro.titulo]">
              <div
                class="book-card bg-white rounded-2xl shadow-lg overflow-hidden h-96 flex flex-col transition-transform duration-200 hover:-translate-y-1 hover:shadow-xl"
              >
                <img
                  [src]="libro.imgSrc"
                  alt="Portada"
                  class="h-56 w-full object-cover"
                />
                <div class="p-4 flex flex-col justify-between flex-1">
                  <h4
                    class="font-bold text-lg line-clamp-2 text-gray-800"
                  >
                    {{ libro.titulo }}
                  </h4>
                  <p class="text-sm text-gray-600 mt-3">
                    {{ libro.autor?.nombre || 'Autor desconocido' }}
                  </p>
                </div>
              </div>
            </a>
          }
        </div>

        <!-- Paginaci√≥n -->
      <div class="animate-fadeInGlow animate-fadeInBlur">
        <nav class="mt-12 flex justify-center items-center select-none flex-wrap gap-2">
        <!-- Bot√≥n anterior -->
        <button
          class="w-10 h-10 border rounded-full flex items-center justify-center text-gray-600
                hover:bg-indigo-500 hover:text-white disabled:opacity-40 disabled:cursor-not-allowed
                transition-all duration-300 ease-out transform hover:scale-110 hover:shadow-md active:scale-95"
          [disabled]="page === 1"
          (click)="cambiarPagina(page - 1)"
        >
      ‚Äπ
        </button>

        <!-- N√∫meros -->
        <button
          *ngFor="let p of paginasVisibles"
          (click)="cambiarPagina(p)"
          [ngClass]="{
            'bg-indigo-600 text-white border-indigo-600 shadow-md scale-110': page === p,
            'text-gray-600 hover:bg-indigo-500 hover:text-white': page !== p
          }"
          class="w-10 h-10 border rounded-full flex items-center justify-center font-semibold
                transition-all duration-300 ease-out transform hover:scale-110 hover:shadow-md active:scale-95"
        >
        {{ p }}
        </button>

        <!-- √öltima p√°gina -->
        <button
          *ngIf="totalPaginas > maxVisible && paginasVisibles[paginasVisibles.length-1] < totalPaginas"
          (click)="cambiarPagina(totalPaginas)"
          class="w-10 h-10 border rounded-full flex items-center justify-center font-semibold text-gray-600
                hover:bg-indigo-500 hover:text-white transition-all duration-300 ease-out transform
                hover:scale-110 hover:shadow-md active:scale-95"
          >
          {{ totalPaginas }}
        </button>

        <!-- Bot√≥n siguiente -->
        <button
          class="w-10 h-10 border rounded-full flex items-center justify-center text-gray-600
                hover:bg-indigo-500 hover:text-white disabled:opacity-40 disabled:cursor-not-allowed
                transition-all duration-300 ease-out transform hover:scale-110 hover:shadow-md active:scale-95"
          [disabled]="page === totalPaginas"
          (click)="cambiarPagina(page + 1)"
        >
          ‚Ä∫
        </button>
      </nav>
    </div>
      </div>
    } @else {
      <!-- Mensaje si no hay resultados -->
      <div>
        <div class="text-center text-gray-500 mt-16 text-lg">
          No se encontraron libros con los filtros seleccionados.
        </div>
      </div>
      }
    </section>
  </div>
</main>

<!-- Spinner de carga -->
@if (procesandoDatos()) {
  <div class="fixed inset-0 flex items-center justify-center bg-gray-900 bg-opacity-50 z-50">
    <div class="relative w-16 h-16">
      <div class="absolute inset-0 rounded-full border-4 border-blue-500 border-t-transparent animate-spin"></div>
      <div class="absolute inset-2 rounded-full border-4 border-t-blue-300 border-transparent animate-spin-slow"></div>
    </div>
  </div>
}
